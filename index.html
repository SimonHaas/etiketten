<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Etiketten</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div class="container">
      <h1>Etiketten</h1>
      <div class="row">
        <div class="col-sm">
          <h2>groß</h2>
          <button
            data-kind="bierschinken"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Bierschinken 300g
          </button>
          <button
            data-kind="bratwurst"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Bratwurstbrät 300g
          </button>
          <button
            data-kind="goettinger"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Göttinger 300g
          </button>
          <button
            data-kind="grobebauernwurst"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Grobe Bauernwurst 300g
          </button>
          <button
            data-kind="jagdwurst"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Jagdwurst 300g
          </button>
          <button
            data-kind="leberkaese"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Leberkäse 300g
          </button>
          <button
            data-kind="roter_pressack"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Roter Preßsack 300g
          </button>
          <button
            data-kind="schinkenwurst"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Schinkenwurst 300g
          </button>
          <button
            data-kind="schweinefleisch"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Schweinefleisch 300g
          </button>
          <button
            data-kind="weisser_pressack"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Weißer Preßsack 300g
          </button>
          <button
            data-kind="schaschliktopf"
            data-size="300"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Schaschliktopf 300g
          </button>
        </div>
        <div class="col-sm">
          <h2>klein</h2>
          <button
            data-kind="bierschinken"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Bierschinken 200g
          </button>
          <button
            data-kind="bratwurst"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Bratwurstbrät 200g
          </button>
          <button
            data-kind="goettinger"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Göttinger 200g
          </button>
          <button
            data-kind="grobebauernwurst"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Grobe Bauernwurst 200g
          </button>
          <button
            data-kind="jagdwurst"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Jagdwurst 200g
          </button>
          <button
            data-kind="leberkaese"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Leberkäse 200g
          </button>
          <button
            data-kind="roter_pressack"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Roter Preßsack 200g
          </button>
          <button
            data-kind="schinkenwurst"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Schinkenwurst 200g
          </button>
          <button
            data-kind="schweinefleisch"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Schweinefleisch 200g
          </button>
          <button
            data-kind="weisser_pressack"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Weißer Preßsack 200g
          </button>
          <button
            data-kind="leberwurst"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Leberwurst 200g
          </button>
          <button
            data-kind="griebenschmalz"
            data-size="250"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Griebenschmalz
          </button>
          <button
            data-kind="zwiebelmettwurst"
            data-size="200"
            type="button"
            class="btn btn-info btn-lg btn-block btn-etikett"
          >
            Zwiebelmettwurst 200g
          </button>
        </div>
      </div>
    </div>
    <script
      src="https://code.jquery.com/jquery-3.5.0.min.js"
      integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ="
      crossorigin="anonymous"
    ></script>
    <script>
      $(document).ready(function () {
        $(".btn-etikett").on("click", (event) => {
          let kind = $(event.target).data("kind");
          let size = $(event.target).data("size");
          generatePDF(kind, size);
        });
      });

      function generatePDF(kind, size) {
        //TODO Schinken, ganz anderes Design

        // Bei Griebenschmalz ist size = 250, es sollen aber kleine Etiketten sein.
        if (size < 300) {
          doc = generateSmallPdf(kind, size);
        } else {
          doc = generateLargePdf(kind, size);
        }

        let uristring = doc.output("datauristring");
        let embed =
          "<embed width='100%' height='100%' src='" + uristring + "'/>";
        let x = window.open();
        x.document.open();
        x.document.write(embed);
        x.document.close();
      }

      function generateSmallPdf(kind, size) {
        let doc = new jsPDF("l", "mm", "a4");

        let width = 90;
        let height = 17;
        let xFirst = 52;
        let yFirst = 24;
        let deltaX = 130;
        let deltaY = 30;

        let kindObject = content[kind];
        let fontName = "times";

        for (let i = 0; i < 6; i++) {
          for (let j = 0; j < 2; j++) {
            let currentX = xFirst + deltaX * j;
            let currentY = yFirst + deltaY * i;
            
            doc.rect(currentX, currentY, width, height);

            doc.setFont(fontName);
            doc.setFontSize(12);
            doc.text(kindObject["prefix"], currentX, currentY + 4);

            doc.setFont(fontName);
            doc.setFontStyle("bold");
            doc.text(kindObject["name"], currentX + 27, currentY + 4);

            doc.setFont(fontName);
            doc.setFontStyle("normal");
            doc.setFontSize(10);
            doc.text("Füllgewicht", currentX, currentY + 8);

            doc.setFont(fontName);
            doc.setFontStyle("bold");
            doc.text(size + "g", currentX + 18, currentY + 8);

            doc.setFont(fontName);
            doc.setFontStyle("normal");
            doc.text("- EIGENE HERSTELLUNG", currentX + 26, currentY + 8);

            doc.setFontSize(6);
            doc.setFontStyle("normal");
            doc.text("Zutaten: " + kindObject["ingredients"], currentX, currentY + 11, {
              maxWidth: width,
              lineHeightFactor: 1,
            });

            doc.setFontSize(5);
            doc.text(
              "Bei Lagerung unter +8°C mindestens haltbar bis: " +
                calculateDate(kindObject["good_for"]),
              currentX + 45,
              currentY + height - 1,
              {}
            );
          }
        }

        return doc;
      }

      function generateLargePdf(kind, size) {
        let doc = new jsPDF("l", "mm", "a4");

        let width = 90;
        let height = 29;
        let xFirst = 53;
        let yFirst = 23;
        let deltaX = 130;
        let deltaY = 48;

        let kindObject = content[kind];
        let fontName = "times";

        for (let i = 0; i < 4; i++) {
          for (let j = 0; j < 2; j++) {
            let currentX = xFirst + deltaX * j;
            let currentY = yFirst + deltaY * i;
            
            //doc.rect(currentX, currentY, width, height);

            doc.setFont(fontName);
            doc.setFontSize(17);
            doc.text(kindObject["prefix"], currentX, currentY + 5);

            doc.setFont(fontName);
            doc.setFontStyle("bold");
            doc.text(kindObject["name"], currentX + 38, currentY + 5);

            doc.setFont(fontName);
            doc.setFontStyle("normal");
            doc.setFontSize(12);
            doc.text("Füllgewicht", currentX, currentY + 10);

            doc.setFont(fontName);
            doc.setFontStyle("bold");
            doc.text(size + "g", currentX + 22, currentY + 10);

            doc.setFont(fontName);
            doc.setFontStyle("normal");
            doc.text("- EIGENE HERSTELLUNG", currentX + 32, currentY + 10);

            doc.setFontSize(8);
            doc.setFontStyle("normal");
            doc.text("Zutaten: " + kindObject["ingredients"], currentX, currentY + 15, {
              maxWidth: width,
              lineHeightFactor: 1,
            });

            doc.text(
              "Bei Lagerung unter +8°C mindestens haltbar bis: " +
                calculateDate(kindObject["good_for"]),
              currentX + 20,
              currentY + height - 2,
              {}
            );
          }
        }

        return doc;
      }

      function calculateDate(goodFor) {
          let date = new Date();
          date.setDate(date.getDate() + goodFor * 30);

          let dateString =
            date.getDate() +
            "." +
            (date.getMonth() + 1) +
            "." +
            date.getFullYear();

          return dateString;
        }

      let content = {
        leberwurst: {
          prefix: "Hausgemachte",
          ingredients:
            "70% Schweinefleisch, 15% Schweineleber, Schwarten, Kochsalz, Zwiebeln, Gewürze (u.a. SELLERIE), Geschmacksverstärker: Natriumglutamat",
          name: "Bauernleberwurst",
          good_for: 7,
        },
        bierschinken: {
          prefix: "Hausgemachter",
          ingredients:
            "70% Schweinefleisch, 10% Rindfleisch, Trinkwasser, Nitritpökelsalz (Kochsalz, Konservierungsstoff E250), Gewürze u.a. SELLERIE, Stabilisator: Phosphat, Geschmacksverstärker: Natriumglutamat",
          name: "Bierschinken",
          good_for: 7,
        },
        bratwurst: {
          prefix: "Hausgemachtes",
          ingredients:
            "80% Schweinefleisch, Trinkwasser, Kochsalz, Gewürze (u.a. SELLERIE), Geschmacksverstärker: Natriumglutamat, Stabilisator: Phosphat",
          name: "Bratwurstbrät",
          good_for: 7,
        },
        goettinger: {
          prefix: "Hausgemachte",
          ingredients:
            "50% Schweinefleisch, 30% Rindfleisch, Trinkwasser, Nitritpökelsalz (Kochsalz, Konservierungsstoff E250), Gewürze u.a. SELLERIE, Stabilisator: Phosphat, Geschmacksverstärker: Natriumglutamat",
          name: "Göttinger",
          good_for: 7,
        },
        grobebauernwurst: {
          prefix: "Hausgemachte",
          ingredients:
            "70% Schweinefleisch, 10% Rindfleisch, Trinkwasser, Nitritpökelsalz (Kochsalz, Konservierungsstoff E 250), Gewürze (u.a. SELLERIE), Kräuter, Geschmacksverstärker: Natriumglutamat, Stabilisator: Phosphat",
          name: "Grobe Bauernwurst",
          good_for: 7,
        },
        jagdwurst: {
          prefix: "Hausgemachte",
          ingredients:
            "70% Schweinefleisch, 15% Rindfleisch, Trinkwasser, Nitritpökelsalz (Kochsalz, Konservierungsstoff E250), Gewürze u.a. SELLERIE, Stabilisator: Phosphat, Geschmacksverstärker: Natriumglutamat",
          name: "Jagdwurst",
          good_for: 7,
        },
        leberkaese: {
          prefix: "Hausgemachter",
          ingredients:
            "70% Schweinefleisch, 10% Rindfleisch, Trinkwasser, Nitritpökelsalz (Kochsalz, Konservierungsstoff E 250), Gewürze u.a. SENF; SELLERIE, Geschmacksverstärker: Natriumglutamat, Stabilisator: Phosphat",
          name: "Leberkäse",
          good_for: 7,
        },
        roter_pressack: {
          prefix: "Hausgemachter",
          ingredients:
            "70% Schweinefleisch, Blut, Schwarten, Fleischbrühe, Leber, Nitritpökelsalz (Kochsalz, Konservierungsstoff E250), Gewürze u.a. SELLERIE, Zwiebeln, Kräuter, Geschmacksverstärker: Natriumglutamat",
          name: "Roter Preßsack",
          good_for: 7,
        },
        schinkenwurst: {
          prefix: "Hausgemachte",
          ingredients:
            "65% Schweinefleisch, 15% Rindfleisch, Trinkwasser, Nitritpökelsalz (Kochsalz, Konservierungsstoff E250), Gewürze u.a. SELLERIE,SENF, Stabilisator: Phosphat, Geschmacksverstärker: Natriumglutamat",
          name: "Schinkenwurst",
          good_for: 7,
        },
        schweinefleisch: {
          prefix: "Hausgemachtes",
          ingredients:
            "90% Schweinefleisch, 5% Schwarten, Nitritpökelsalz (Kochsalz, Konservierungsstoff E250), Gewürze u.a. SELLERIE, Geschmacksverstärker: Natriumglutamat",
          name: "Schweinefleisch",
          good_for: 7,
        },
        weisser_pressack: {
          prefix: "Hausgemachter",
          ingredients:
            "70% Schweinefleisch, Schwarten, Fleischbrühe, Leber, Nitritpökelsalz (Kochsalz, Konservierungsstoff E250), Gewürze u.a. SELLERIE, Zwiebeln, Kräuter, Geschmacksverstärker: Natriumglutamat",
          name: "Weißer Preßsack",
          good_for: 7,
        },
        zwiebelmettwurst: {
          prefix: "Hausgemachte",
          ingredients:
            "80% Schweinefleisch, Fleischbrühe, Zwiebeln, Gewürze (u.a. SELLERIE, LACTOSE), Nitritpökelsalz (Kochsalz, Konservierungsstoff E 250), Geschmacksverstärker: Natriumglutamat",
          name: "Zwiebelmettwurst",
          good_for: 7,
        },
        griebenschmalz: {
          prefix: "Hausgemachtes",
          ingredients:
            "95 % Schweinefett, Grieben, Röstzwiebeln (Weizenmehl, Gluten, pflanz. Öl) Gewürze, Kochsalz",
          name: "Griebenschmalz",
          good_for: 5,
        },
        schaschliktopf: {
          prefix: "Hausgemachter",
          ingredients:
            "Schweinefleisch, Räucherkamm, Zwiebeln, Paprika, Schaschliksoße enthält SENF, Gewürze",
          name: "Schaschliktopf",
          good_for: 5,
        },
      };
    </script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"
      integrity="sha384-NaWTHo/8YCBYJ59830LTz/P4aQZK1sS0SneOgAvhsIl3zBu8r9RevNg5lHCHAuQ/"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
      integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
      integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
      integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
